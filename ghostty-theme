#!/bin/bash
# Ghostty Theme Switcher - Main Entry Point
# https://github.com/yourusername/ghostty-theme-switch

set -e

VERSION="2.5.0"

# Resolve script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# Colors
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
CYAN='\033[0;36m'
BOLD='\033[1m'
NC='\033[0m'

# Export for subshells
export SCRIPT_DIR RED GREEN YELLOW CYAN BOLD NC

# Source core modules
source "$SCRIPT_DIR/src/core/config.sh"
source "$SCRIPT_DIR/src/core/theme.sh"
source "$SCRIPT_DIR/src/core/utils.sh"

# Source selector modules
source "$SCRIPT_DIR/src/selector/fzf.sh"
source "$SCRIPT_DIR/src/selector/simple.sh"

# Interactive selector
interactive_select() {
    echo -e "${CYAN}Ghostty Theme Selector${NC} v${VERSION}"
    echo ""

    if command -v fzf &>/dev/null; then
        fzf_select
    else
        echo -e "${YELLOW}fzf not found. Using simple selector...${NC}"
        echo -e "${CYAN}Tip: Install fzf for better experience${NC}"
        echo ""
        sleep 1
        simple_select
    fi
}

# Main
main() {
    case "$1" in
        ""|"-i"|"--interactive")
            interactive_select
            ;;
        "list"|"--list"|"-l")
            list_themes
            ;;
        "current"|"--current"|"-c")
            echo -e "${CYAN}Current theme:${NC} ${BOLD}$(get_current_theme)${NC}"
            ;;
        "random"|"--random"|"-r")
            set_random_theme
            ;;
        "light"|"--light")
            set_mode_theme "light"
            ;;
        "dark"|"--dark")
            set_mode_theme "dark"
            ;;
        "version"|"--version"|"-v")
            echo "ghostty-theme v${VERSION}"
            ;;
        "help"|"--help"|"-h")
            usage
            ;;
        "reload-hint")
            echo "$RELOAD_HINT"
            ;;
        *)
            apply_direct "$*"
            ;;
    esac
}

main "$@"
